services:

  # NestJS 애플리케이션 컨테이너 정의
  app:
    # 현재 디렉터리의 Dockerfile을 이용해서 이미지 빌드                            
    # build: .
    image: kimuijin5663/nest-shopping:latest
    # 컨테이너 이름(도커 명령어에서 이 이름으로 접근) 
    container_name: nest-shopping-app
    # 컨테이너가 죽으면 항상 자동 재시작
    restart: always 
    # 호스트 포트:컨테이너 포트 매핑 (.env에서 값 읽어옴)              
    ports:
      - "3000:3000"
    # .env 파일에 있는 환경변수들을 컨테이너 안으로 주입     
    env_file:
      - .env.production
    # 호스트 ./uploads ↔ 컨테이너 /app/uploads 폴더를 공유(업로드 파일 보존)
    volumes:
      - ./uploads:/app/uploads
    # Dockerfile의 CMD 대신 이 명령으로 컨테이너 시작
    command: ["npm", "run", "start:prod"]  